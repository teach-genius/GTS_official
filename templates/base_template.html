{% load static %}
<!DOCTYPE html >
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="GTS - Votre compagnon pour √©tudier et trouver un logement au Maroc. √âcoles v√©rifi√©es, logements de qualit√© et conseils IA personnalis√©s.">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style src="{% static 'css/voirdetails.css' %}"></style>
    {% block css %}{% endblock %}
    <title>{% block title %}GTS - Global Talaba Students{% endblock %}</title>
</head>

<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="{% url 'home' %}">
                    <img src="{% static 'imgs/logo_gts.png' %}" alt="Logo GTS Global Talaba Students">
                    <div class="logo-text">
                        <span>GTS</span>
                        <span>Global Talaba Students</span>
                    </div>
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="{% url 'home' %}"  class="{% if request.resolver_match.url_name == 'home' %}active{% endif %}"
                            aria-label="Accueil">Accueil</a></li>
                    
                    <li><a href="{% url 'ecoles:ecoles' %}" class="{% if request.resolver_match.url_name == 'ecoles' %}active{% endif %}"
                            aria-label="√âcoles">√âcoles</a></li>
                    
                    <li><a href="{% url 'logements:logements' %}" class="{% if request.resolver_match.url_name == 'logements' %}active{% endif %}"
                            aria-label="Logements">Logements</a></li>
                    
                    {% if user.is_authenticated %}
                    <li><a id="reserveId" href="{% url 'reservations' %}"
                            class="{% if request.resolver_match.url_name == 'reservations' %}active{% endif %}" style="display: flex;">Mes demandes {% if total_d > 0 %} <span style="margin-left: 5px;width: 20px;height: 20px;background-color: #ff4e50;border-radius: 8px;color: white;display: flex;align-items: center;justify-content: center;">{{total_d}}</span>{% endif %}</a>
                    </li>
                    <li><a id="favorId" href="{% url 'favoris' %}"
                            class="{% if request.resolver_match.url_name == 'favoris' %}active{% endif %}">Favoris
                            </span></a></li>
                    {% endif %}
                    <li><a href="{% url 'contact' %}"  class="{% if request.resolver_match.url_name == 'contact' %}active{% endif %}"
                            aria-label="Contact">Contact</a></li>
                    {% if user.is_authenticated %}
                    <li class="b_out" ><a href="{% url 'deconnexion' %}" class="logout-button" style="margin-top: 10px;display: flex;align-items: center;justify-content: center;"><span class="material-icons icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>D√©connexion</a></li>
                    {% else %}
                    <li class="b_out"><a href="{% url 'connexion' %}" class="btn-primary" style="margin-top: 10px;display: flex;align-items: center;justify-content: center;">Connexion</a></li>
                    {% endif %}
                </ul>
            </nav>

           


            <div class="header-actions">
                {% if user.is_authenticated %}
                <a href="{% url 'deconnexion' %}" class="logout-button"
                    style="border: 1px solid hsl(220deg 100% 50% / 30%);">
                    <span class="material-icons icon"><i class="fa-solid fa-arrow-right-from-bracket"></i></span>
                    D√©connexion
                </a>
                {% else %}
                <a href="{% url 'connexion' %}" class="btn-primary">Connexion</a>
                {% endif %}
                <button class="menu-toggle" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
        </div>
    </header>


 <style>
    .warning_toogle{
    z-index: 999;
    display: none; 
    padding: 2rem;
    flex-direction: column;
    align-items: center; 
    font-size: 18px; 
    position: fixed;
    top: 200px;
}
.b_out{
    display: none;
}

@media (max-width: 992px) {
    .warning_toogle{
    display: flex;
}
    .b_out{
    display: block;
}
#m-ain{
    display: none;
}

}

@media (max-width: 768px) {
    .warning_toogle{
    display: flex;
}
   .b_out{
    display: block;
}
#m-ain{
    display: none;
}

}

@media (max-width: 480px) {
.warning_toogle{
    display: flex;
}

 .b_out{
    display: block;
}
#m-ain{
    display: none;
}

}

</style>

<div class="warning_toogle" >
    <div style="border-radius: 20px; background-color: #ff4e50;width: 100px;height: 100px;text-align: center;display: flex;align-items: center;justify-content: center;">
        <i style="font-size: 50px; color: #ffffff;" class="fa-solid fa-triangle-exclamation"></i>
    </div>
        <div style="text-align: center;margin-top: 50px;">
        Cette application n‚Äôest pas disponible sur les petits √©crans.
        Veuillez utiliser un appareil avec un √©cran plus grand.
    </div>
</div>


    <main id="m-ain">
        {% block content %}
        {% endblock %}
    </main>

    <footer>
       
    </footer>

    {# Script pour la navigation mobile (√† ajouter plus tard avec JS) #}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const menuToggle = document.querySelector('.menu-toggle');
            const mainNav = document.querySelector('.main-nav');

            menuToggle.addEventListener('click', function () {
                mainNav.classList.toggle('active');
                this.querySelector('i').classList.toggle('fa-bars');
                this.querySelector('i').classList.toggle('fa-times'); // Change icon to 'X'
            });
        });
    </script>

    <div onclick="toggleChat()" style="
    z-index: 999;
    position: fixed;
    bottom: 50px;
    right: 12px;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 50px;
    width: 50px;
    font-size: 24px;
    color: white;
    border-radius: 12px;
    background: linear-gradient(135deg, #0056b3, #00aaff);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.3)'"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'">
        <i class="fa-solid fa-comment"></i>
    </div>




    <!-- üíª Chatbox -->
    <div id="chat-box" style="
        width: 320px;
        height: 450px;
        background-color: #f5f8ff;
        position: fixed;
        bottom: 20px;
        right: 10px;
        border-radius: 15px;
        box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        flex-direction: column;
        overflow: hidden;
        z-index: 1000;
        font-family: Arial, sans-serif;
        opacity: 0;
        transform: translateY(30px);
        pointer-events: none;
        transition: opacity 0.4s ease, transform 0.4s ease;
        display: flex;
    ">

        <!-- üîµ Header -->
        <div
            style="align-items: center; display: flex;width: 100%;justify-content: space-between; background: linear-gradient(to right, #007bff, #0056b3); color: white; padding: 15px; font-weight: bold; text-align: center; font-size: 16px;">
            <div
                style="justify-content: space-around;align-items: center; display: flex;flex-direction: row;gap: 10px;">
                <i class="fas fa-robot"></i> <span>GTS AI Orientation</span>
            </div>
            <button onclick="toggleChat()" style="
    background: linear-gradient(135deg, #ff4e50, #f9d423);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 24px;
    width: 40px;
    height: 40px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.3)'"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'">
                &times;
            </button>

        </div>

        <!-- üí¨ Zone messages -->
        <div id="chat-content"
            style="flex: 1; padding: 15px; overflow-y: auto; background: #f0f2f5; display: flex; flex-direction: column; gap: 10px;">

        </div>

        <!-- ‚å®Ô∏è Input -->
        <div style="padding: 10px; border-top: 1px solid #ccc; background: white;">
            <input type="text" id="chat-input" placeholder="Pose ta question..."
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 20px; outline: none; font-size: 14px;"
                onkeydown="if(event.key==='Enter') sendChat()" />
        </div>
    </div>


    <script>

        function toggleChat() {
            const box = document.getElementById('chat-box');
            const isVisible = box.style.opacity === '1';

            if (isVisible) {
                box.style.opacity = '0';
                box.style.transform = 'translateY(30px)';
                box.style.pointerEvents = 'none';
            } else {
                box.style.opacity = '1';
                box.style.transform = 'translateY(0)';
                box.style.pointerEvents = 'auto';
            }
        }

        const feat_bot = document.getElementById('feat-bot');
        feat_bot.addEventListener('click', function (params) {
            toggleChat();
        })

        const feat_ecole = document.getElementById('feat-ecole');
        feat_ecole.addEventListener('click', function (params) {
            window.location.href = "{% url 'ecoles:ecoles' %}";
        })

        const feat_logement = document.getElementById('feat-logement');
        feat_logement.addEventListener('click', function (params) {
            window.location.href = "{% url 'logements:logements' %}";
        })

    </script>

    <script>
        async function sendChat() {
            const input = document.getElementById("chat-input");
            const content = document.getElementById("chat-content");
            const message = input.value.trim();
            if (message === "") return;

            // Affiche le message utilisateur
            content.innerHTML += `
            <div style="align-self: flex-end; max-width: 80%; background-color: #dcf8c6; padding: 10px 15px; border-radius: 18px 18px 0 18px; font-size: 14px;">
                <span>${message}</span>
            </div>`;
            content.scrollTop = content.scrollHeight;
            input.value = "";

            // üëâ Ajouter une bulle de "typing..." (animation points)
            const typingIndicator = document.createElement("div");
            typingIndicator.id = "typing-indicator";
            typingIndicator.style = `
            align-self: flex-start; 
            max-width: 80%; 
            background-color: #ffffff; 
            padding: 10px 15px; 
            border-radius: 18px 18px 18px 0; 
            font-size: 14px; 
            font-style: italic; 
            color: #999;
            display: flex; 
            gap: 4px;
        `;
            typingIndicator.innerHTML = `<span>ü§ñ GTS √©crit</span><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>`;
            content.appendChild(typingIndicator);
            content.scrollTop = content.scrollHeight;

            try {
                const res = await fetch("{% url 'orientation:chat_api' %}", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message }),
                });

                const data = await res.json();

                // Supprimer l'indicateur de typing
                typingIndicator.remove();

                // Affiche la r√©ponse de l'IA
                content.innerHTML += `
                <div style="align-self: flex-start; max-width: 80%; background-color: #ffffff; padding: 10px 15px; border-radius: 18px 18px 18px 0; font-size: 14px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                    <span>ü§ñ ${data.reply}</span>
                </div>`;
                content.scrollTop = content.scrollHeight;

            } catch (err) {
                typingIndicator.remove();

                content.innerHTML += `
                <div style="align-self: flex-start; color: red;">
                    <span>‚ùå Erreur lors de la communication avec le serveur.</span>
                </div>`;
            }
        }
    </script>
    <style>
        .dot {
            animation: blink 1.4s infinite;
            font-weight: bold;
            font-size: 18px;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0% {
                opacity: 0.2;
            }

            20% {
                opacity: 1;
            }

            100% {
                opacity: 0.2;
            }
        }
    </style>


    <div id="globalToast"
        style="display:none; align-items:center; justify-content:space-between; gap:10px; position:fixed; bottom:30px; right:30px; z-index:9999; min-width:220px; color:white; padding:12px 22px; border-radius:10px; box-shadow:0 6px 24px rgba(0,0,0,0.13); font-size:0.98em; transition:opacity 0.5s cubic-bezier(.4,0,.2,1), transform 0.5s cubic-bezier(.4,0,.2,1); opacity:1; pointer-events:auto; transform:translateY(0);">

        <span id="globalToastMsg">
        </span>

        <button onclick="closeGlobalToast()"
            style="background:none; border:none; font-size:1.1em; color:#555; cursor:pointer; margin-left:10px;">
            &times;
        </button>
    </div>

    <script>
        
    function closeGlobalToast() {
        const toast = document.getElementById('globalToast');
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(30px)';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 500);
    }
    

    function showGlobalToast(message, duration = 5000) {
    const toast = document.getElementById('globalToast');
    const msg = document.getElementById('globalToastMsg');
    msg.textContent = message;

    toast.style.display = 'flex';
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
    
    setTimeout(() => closeGlobalToast(), duration);
}

</script>
<script>
  document.addEventListener('contextmenu', e => e.preventDefault()); // clic droit
  document.addEventListener('selectstart', e => e.preventDefault()); // d√©but de s√©lection
</script>

{% if messages %}
        {% for message in messages %}
            <script>
            messageText= "{{message}}";
            const messageTags = "{{ message.tags }}"; // Ex: "success", "warning", "error", "info"
            const toast = document.getElementById('globalToast');
            // Vous pouvez utiliser messageTags pour d√©terminer le type de toast √† afficher
            if (messageTags.includes('success')) {
                toast.style.backgroundColor="#28a745";
                toast.style.color ="white";
                showGlobalToast(messageText,5000); // Passer 'success' comme type
            } else if (messageTags.includes('warning')) {
                toast.style.color="#343a40";
                toast.style.backgroundColor="#ffc107";
                showGlobalToast(messageText, 5000); // Passer 'warning' comme type
            } else if (messageTags.includes('error')) {
                toast.style.backgroundColor="#dc3545";
                toast.style.color ="white";
                showGlobalToast(messageText, 5000);   // Passer 'error' comme type
            } else {
                toast.style.backgroundColor="#17a2b8";
                toast.style.color ="white";
                showGlobalToast(messageText, 5000);    // Par d√©faut, ou pour 'info'
            }
            </script>
        {% endfor %}
{% endif %}

<script src="{% static 'js/voirdetails.js' %}"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- Gestion des √©tapes du formulaire ---
        let currentStep = 1;
        const totalSteps = 5;

        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const currentStepText = document.getElementById('current-step-text');
            const currentProgressPercent = document.getElementById('current-progress-percent');

            if (progressBar && currentStepText && currentProgressPercent) {
                const percentage = (currentStep / totalSteps) * 100;
                progressBar.style.width = percentage + '%';
                currentStepText.textContent = `√âtape ${currentStep} sur ${totalSteps}`;
                currentProgressPercent.textContent = `${percentage.toFixed(0)}%`;
            }
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.form-section').forEach(section => {
                section.style.display = 'none';
            });

            const currentSection = document.getElementById(`if${stepNumber}`);
            if (currentSection) {
                currentSection.style.display = 'block';
            }
            updateProgressBar();
        }

        window.nextStep = function() {
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        };

        window.prevStep = function() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        };

        showStep(currentStep);

        // --- Gestion de l'ouverture/fermeture de la demande ---
        window.opendemande = function() {
            const identifiant_ecole_send = document.getElementById('identifiant_ecole_send');
            const identifiant_ecole_ = document.getElementById('identifiant_ecole_');
            if (identifiant_ecole_send && identifiant_ecole_) {
                identifiant_ecole_.value = identifiant_ecole_send.value;
            }

            const form = document.getElementById('form_demande');
            if (form) {
                form.style.display = 'block';
            }
        };

        window.closedemande = function() {
            const form = document.getElementById('form_demande');
            if (form) {
                form.style.display = 'none';
                window.location.href = window.location.href;
            }
        };

        // --- Validation et affichage des noms de fichiers ---
        const IMAGE_MIN_SIZE_BYTES = 50 * 1024; // 0 Octets
        const IMAGE_MAX_SIZE_BYTES = 1 * 1024 * 1024; // 1 Mo
        const DOCUMENT_MIN_SIZE_BYTES = 100 * 1024; // 0 Octets
        const DOCUMENT_MAX_SIZE_BYTES = 2 * 1024 * 1024; // 2 Mo

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Octets';
            const k = 1024;
            const sizes = ['Octets', 'Ko', 'Mo', 'Go', 'To'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function handleFileUpload(inputElement, textElementId, type) {
            const file = inputElement.files[0];
            const textElement = document.getElementById(textElementId);
            const imagePreviewContainer = document.getElementById('image-preview-container');

            if (file) {
                let minSize, maxSize, fileTypeLabel;
                if (type === 'image') {
                    minSize = IMAGE_MIN_SIZE_BYTES;
                    maxSize = IMAGE_MAX_SIZE_BYTES;
                    fileTypeLabel = 'image';
                } else if (type === 'document') {
                    minSize = DOCUMENT_MIN_SIZE_BYTES;
                    maxSize = DOCUMENT_MAX_SIZE_BYTES;
                    fileTypeLabel = 'document';
                }

                // V√©rifier la taille du fichier en premier
                if (file.size < minSize || file.size > maxSize) {
                    const toast = document.getElementById('globalToast');
                    toast.style.background='#c9302c';
                    toast.style.color='white';
                    showGlobalToast("Taille du fichier non conforme", duration = 5000);
                    inputElement.value = ''; // Effacer le champ de saisie de fichier
                    // R√©initialiser le texte et l'aper√ßu √† l'√©tat par d√©faut pour les fichiers non valides
                    if (textElement) {
                        textElement.textContent = (inputElement.id === 'photo_upload_input') ? 'Charger image' : 'Choisir un fichier';
                    }
                    if (inputElement.id === 'photo_upload_input') {
                        imagePreviewContainer.innerHTML = '<i class="fa fa-user" style="font-size: 30px; color: #aaa;"></i>'; // R√©initialiser l'aper√ßu photo
                    }
                    return; // Sortir de la fonction car le fichier n'est pas valide
                }

                // Si le fichier est valide, proc√©der √† l'affichage du nom et √† la pr√©visualisation
                let fileName = file.name;
                if (fileName.length > 20) {
                    fileName = fileName.substring(0, 17) + '...';
                }
                if (textElement) {
                    textElement.textContent = fileName;
                }

                if (inputElement.id === 'photo_upload_input') {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreviewContainer.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // Au cas o√π un fichier non-image est s√©lectionn√©, m√™me si valide en taille
                        imagePreviewContainer.innerHTML = '<i class="fa fa-user" style="font-size: 30px; color: #aaa;"></i>';
                    }
                }
            } else {
                // Si aucun fichier n'est s√©lectionn√© (ex: l'utilisateur annule la bo√Æte de dialogue)
                if (textElement) {
                    textElement.textContent = (inputElement.id === 'photo_upload_input') ? 'Charger image' : 'Choisir un fichier';
                }
                if (inputElement.id === 'photo_upload_input') {
                    imagePreviewContainer.innerHTML = '<i class="fa fa-user" style="font-size: 30px; color: #aaa;"></i>';
                }
            }
        }

        const fileInputs = [
            { id: 'photo_upload_input', textId: 'photo_upload_input_text', type: 'image' },
            { id: 'cv_upload_input', textId: 'cv_upload_input_text', type: 'document' },
            { id: 'releve_notes_upload_input', textId: 'releve_notes_upload_input_text', type: 'document' },
            { id: 'bac_diploma_upload_input', textId: 'bac_diploma_upload_input_text', type: 'document' },
            { id: 'cni_copy_upload_input', textId: 'cni_copy_upload_input_text', type: 'document' },
            { id: 'lettre_motivation_input', textId: 'lettre_motivation_input_text', type: 'document' },
            { id: 'recommandation_load_input', textId: 'recommandation_load_input_text', type: 'document' }
        ];

        fileInputs.forEach(item => {
            const inputElement = document.getElementById(item.id);
            if (inputElement) {
                inputElement.addEventListener('change', () => handleFileUpload(inputElement, item.textId, item.type));
            }
        });

        // --- Restriction de l'ann√©e du bac ---
        const anneeBacInput = document.getElementById('annee_bac');
        if (anneeBacInput) {
            const anneeActuelle = new Date().getFullYear();
            anneeBacInput.max = anneeActuelle;
        }
    });
</script>



<!-- voir les details -->
 <script>
    const monBouton = document.getElementById('postdem')
function handleClick() {
    const view_Ecole = document.getElementById('view_Ecole');
    view_Ecole.style.display = 'none';
}
monBouton.addEventListener('click', handleClick);

function decodeUnicode(str) {
    return str.replace(/\\u[\dA-Fa-f]{4}/g, match =>
        String.fromCharCode(parseInt(match.replace('\\u', ''), 16))
    );
}

function openView(buttonElement) {
    const Connected = buttonElement.dataset.connected === 'true';
    const view_Ecole = document.getElementById('view_Ecole');

    if (Connected) {
        const schoolId = buttonElement.dataset.schoolId;
        const identifiant_ecole = document.getElementById('identifiant_ecole_send');
        const isFavoritedEcole_update = buttonElement.dataset.isFavorited === "true";
        const val = document.getElementById('Ecole_Id_f');
        updateBtn(isFavoritedEcole_update);
        if (identifiant_ecole) {
            identifiant_ecole.value = schoolId;
        }
        if (val) {
            val.value = schoolId;
        }
    }



    const schoolName = decodeUnicode(buttonElement.dataset.schoolName);
    document.getElementById('ecole_name_demande').textContent = schoolName;
    const schoolImages = JSON.parse(buttonElement.dataset.schoolImages);
    const schoolLocation = decodeUnicode(buttonElement.dataset.schoolLocation);
    const schoolDescription = decodeUnicode(buttonElement.dataset.schoolDescription);
    const schoolRating = buttonElement.dataset.schoolRating;
    const isPrivate = buttonElement.dataset.isPrivate === 'true';
    const schoolAddress = decodeUnicode(buttonElement.dataset.schoolAddress);
    const formations = JSON.parse(buttonElement.dataset.formations);
    const latitude = buttonElement.dataset.latitude;
    const longitude = buttonElement.dataset.longitude;



    document.getElementById('modalSchoolRating').textContent = schoolRating;
    document.getElementById('modalSchoolName').textContent = schoolName;
    document.getElementById('modalSchoolDescription').textContent = schoolDescription;

    document.getElementById('modalSchoolLocation').textContent = schoolLocation;
    document.getElementById('modalSchoolAddress').textContent = schoolAddress;
    document.getElementById('modalSchoolUniversity').textContent = schoolName;


    // G√©rer le carrousel d'images
    const carousel = document.querySelector('.school-image-carousel');
    const carouselDots = document.getElementById('schoolCarouselDots');
    carousel.innerHTML = ''; // Nettoyer les images pr√©c√©dentes
    carouselDots.innerHTML = ''; // Nettoyer les points pr√©c√©dents

    if (schoolImages && schoolImages.length > 0) {
        schoolImages.forEach((imageUrl, index) => {
            const wrapper = document.createElement('div');
            wrapper.classList.add('school-image-wrapper');
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = `Image de l'√©cole ${schoolName} - ${index + 1}`;
            wrapper.appendChild(img);
            carousel.appendChild(wrapper);

            const dot = document.createElement('span');
            dot.classList.add('carousel-dot');
            dot.setAttribute('role', 'tab');
            dot.setAttribute('aria-controls', `image-${index}`);
            dot.setAttribute('tabindex', '0');
            if (index === 0) {
                dot.classList.add('active');
                dot.setAttribute('aria-selected', 'true');
            } else {
                dot.setAttribute('aria-selected', 'false');
            }
            dot.addEventListener('click', () => {
                carousel.scrollTo({
                    left: wrapper.offsetLeft,
                    behavior: 'smooth'
                });
            });
            carouselDots.appendChild(dot);
        });

        // Mise √† jour des points quand le carrousel scroll
        carousel.addEventListener('scroll', () => {
            const scrollLeft = carousel.scrollLeft;
            const itemWidth = carousel.children[0].offsetWidth;
            const activeIndex = Math.round(scrollLeft / itemWidth);

            carouselDots.querySelectorAll('.carousel-dot').forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.add('active');
                    dot.setAttribute('aria-selected', 'true');
                } else {
                    dot.classList.remove('active');
                    dot.setAttribute('aria-selected', 'false');
                }
            });
        });

    } else {
        // G√©rer le cas o√π il n'y a pas d'images
        const noImageWrapper = document.createElement('div');
        noImageWrapper.classList.add('school-image-wrapper');
        noImageWrapper.style.backgroundColor = '#e0e0e0';
        noImageWrapper.style.color = '#777';
        noImageWrapper.style.display = 'flex';
        noImageWrapper.style.justifyContent = 'center';
        noImageWrapper.style.alignItems = 'center';
        noImageWrapper.textContent = "Pas d'image disponible pour cette √©cole.";
        carousel.appendChild(noImageWrapper);
    }

    // G√©rer la liste des formations
    const formationsList = document.getElementById('modalFormationsList');
    formationsList.innerHTML = ''; // Nettoyer les formations pr√©c√©dentes

    if (formations && formations.length > 0) {
        formations.forEach(formation => {
            const formationItem = document.createElement('div');
            formationItem.classList.add('formation-item');
            formationItem.innerHTML = `
                <div class="formation-header">
                    <h4>${decodeUnicode(formation.name)}</h4>
                    <span class="degree-badge">${decodeUnicode(formation.degree)}</span>
                </div>
                <p class="formation-description">${decodeUnicode(formation.description)}</p>
                <div class="formation-footer">
                    <span>Dur√©e: ${decodeUnicode(formation.duration)}</span>
                    <span class="formation-price">Co√ªt: ${decodeUnicode(formation.price)}</span>
                </div>
            `;
            formationsList.appendChild(formationItem);
        });
    } else {
        formationsList.innerHTML = '<p>Aucune formation disponible pour le moment.</p>';
    }

    const all_view_formations = document.getElementById('all_view_formations');

    if (formations && formations.length > 0) {
        formations.forEach(formation => {
            // CR√âATION DE L'√âL√âMENT OPTION :
            const optionElement = document.createElement('option');
            // Attribution de la valeur et du texte :
            optionElement.value = formation.identifiant_id; // Utilisez formation.identifiant pour la valeur
            optionElement.textContent = formation.name;    // Utilisez formation.name pour le texte affich√©
            // AJOUT DE L'√âL√âMENT OPTION AU SELECT :
            all_view_formations.appendChild(optionElement);
        });
    }

    // G√©rer la carte Google Maps
    const mapFrame = document.getElementById('modalMapFrame');
    const mapErrorOverlay = document.getElementById('mapErrorOverlay');
    const mapErrorOkButton = document.getElementById('mapErrorOkButton');
    const Maps_API_KEY = "AIzaSyAT2Sl2zuP5FKaxCnbEEzxGE8i-UT4bfW8";


    // Construire l'URL de la carte en utilisant la latitude et la longitude
    let mapEmbedUrl = '';
    if (latitude && longitude) {
        mapEmbedUrl = `https://www.google.com/maps/embed/v1/place?key=${Maps_API_KEY}&q=${latitude},${longitude}`;
    } else {
        mapEmbedUrl = `https://www.google.com/maps/embed/v1/place?key=${Maps_API_KEY}&q=34.0230144,-6.8190208`;
    }

    if (mapEmbedUrl) {
        mapFrame.src = mapEmbedUrl;
        mapFrame.style.display = 'block';
        mapErrorOverlay.style.display = 'none';
    } else {
        mapFrame.style.display = 'none';
        mapErrorOverlay.style.display = 'flex';
    }
    mapErrorOkButton.onclick = () => {
        mapErrorOverlay.style.display = 'none';
    };
    view_Ecole.style.display = 'block';
}




function closeView() {
    const view_Ecole = document.getElementById('view_Ecole');
    view_Ecole.style.display = 'none';
}

function updateBtn(isFavorited_true) {
    const addToFavBtn = document.getElementById('addToFavBtn');
    const heartIcon = addToFavBtn.querySelector('#add_msg');
    const favButtonText = document.getElementById('favButtonText');
    if (isFavorited_true) {
        addToFavBtn.classList.add('favorited');
        addToFavBtn.classList.remove('add-to-fav-btn');
        heartIcon.classList.remove('far');
        heartIcon.classList.add('fas');
        favButtonText.textContent = 'Supprimer des favoris';
        const isFavorisedInput = document.getElementById('isFavorised');
        if (isFavorisedInput) {
            isFavorisedInput.value = 'true';
        }
        addToFavBtn.onmouseover = null;
        addToFavBtn.onmouseout = null;
    } else {
        addToFavBtn.classList.remove('favorited');
        addToFavBtn.classList.add('add-to-fav-btn');
        heartIcon.classList.remove('fas');
        heartIcon.classList.add('far');
        favButtonText.textContent = 'Ajouter aux favoris';
        const isFavorisedInput = document.getElementById('isFavorised');
        if (isFavorisedInput) {
            isFavorisedInput.value = 'false';
        }
        addToFavBtn.onmouseover = null;
        addToFavBtn.onmouseout = null;
    }
}
 </script>
</body>
</html>